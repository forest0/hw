# 计算机图形学第一次作业报告

## 实验环境

Ubuntu 14.04 + Qt 5.2.1 + Qt Creator 4.4.1 + GCC 5.4.1

## 实验目标

利用 Qt 库提供的绘图机制, 事件处理机制和对象间通信机制来实现一个简单的绘图应用.

## 设计

### 目标

本次作业的目标是实现一个简单的桌面绘图应用, 提供绘制直线, 绘制椭圆, 绘制矩形, 绘制多边形, 绘制鼠标轨迹的功能. 在此基础之上, 我也提供了编辑操作中常见的撤销和恢复功能.

### 思路

1. 本应用中的数据模型有直线, 椭圆, 矩形, 多边形和鼠标轨迹, 利用面向对象的方法可以抽象出一个继承关系如下图:

![图1](./class_diagram.png)

其中 `Figure` 为基类, 提供了一个虚方法 `drawWith()`, 这样可利用面向对象继承和多态的特性, 方便地组织各种图形数据, 在绘制上提供了一个统一的接口, 也便于扩展.

2. 本应用中有了数据模型, 还需要有相应的视图呈现给用户. 于是采取了数据模型与视图相分离的做法, 抽象出一个 `Board` 数据模型, 主要负责组织和存储各种图形类型; 也抽象出一个 `BoardView` 视图, 主要负责各种图形的展示, 这样做的好处是减低了耦合度.

3. 本应用是一个 GUI 应用, 自然要处理用户的输入并进行相应的响应, 这里可利用 Qt 的 signal-slot 对象间通信机制和事件处理机制来保证事件的处理.

4. 因为要绘制图形, 所以可让 `BoardView` 继承自 `QWidget`, 再重写其绘制事件便可以做到自定义绘制图形.

5. 要想提供撤销与恢复功能, 便需要用两个数据结构, 一个用来记录用户新添加的图形, 另一个用来记录用户删除的图形. 这两个数据结构位于 `Board` 数据模型中, 在需要的时候利用 signal-slot 来保证数据和视图的同步.

注: *图1仅是为了表明继承关系和统一接口, 并未展示出其全部成员.*

## 项目结构

```
src
├── Constants.h                 <-- 常量定义
├── GraffitiBoard.pro           <-- Qt 项目文件
├── GraffitiBoard.pro.user
├── main.cpp                    <-- 入口文件
├── model                       <-- 这个目录存放数据类
│   ├── Board.cpp
│   ├── Board.h                 <-- 主要数据模型
│   └── figures                 <-- 这个目录存放各种图形类
│       ├── Ellipse.cpp
│       ├── Ellipse.h
│       ├── Figure.cpp
│       ├── Figure.h            <-- 图形基类
│       ├── FreeDraw.cpp
│       ├── FreeDraw.h
│       ├── Line.cpp
│       ├── Line.h
│       ├── Polygon.cpp
│       ├── Polygon.h
│       ├── Rectangle.cpp
│       └── Rectangle.h
├── resources                   <-- 资源文件夹
│   └── icon
│       ├── ellipse.png
│       ├── free.png
│       ├── line.png
│       ├── mainIcon.png
│       ├── polygon.png
│       ├── rectangle.png
│       ├── redo.png
│       └── undo.png
├── resources.qrc               <-- Qt 资源文件
├── tools                       <-- 这个目录存放工具类
│   ├── Log.cpp
│   ├── Log.h
│   ├── Utils.cpp
│   └── Utils.h
└── view                        <-- 这个目录存放视图类
    ├── BoardView.cpp
    ├── BoardView.h             <-- 主要视图类
    ├── MainWindow.cpp
    ├── MainWindow.h            <-- 主程序窗体
    └── MainWindow.ui

6 directories, 36 files
```

## 优点与缺点

优点:
- 利用面向对象, 方便地组织了图形数据, 也为绘图提供了统一的接口.
- 视图与数据模型的分离, 降低了耦合度.
- 代码中坚持良好的命名方式, 基本做到了见名知义.
- 除了做到基本的绘图功能外, 还添加了撤销和恢复功能.

缺点:
- 视图和用户交互的紧耦合, 努力想做到 MVC, 但只分离了数据和视图.
- 因为忙于其它比赛, 时间仓猝, 没有重构来提高代码质量

## 实验结果

开发出了提供绘制直线, 椭圆, 矩形, 多边形, 鼠标轨迹的桌面绘图应用, 还提供了撤销和恢复功能.

软件截图如下
![图2](./graffiti_board.png)

源代码请查看压缩包中 `src` 目录, 压缩包中同样也提供了演示视频.

注: *图2中没有菜单栏是应为 Ubuntu 14.04 的菜单栏在桌面窗体中而不是在应用窗体中*

## 总结

1. 熟悉了 Qt 库的使用, 了解了其独特的对象间通信机制, 掌握了在 Linux 下 GUI 应用的开发.
2. 熟悉了一些 C++ 11 的新特性, 例如自动类型推导, range-based for 循环, lambda 表达式等.
3. 本次作业中使用到了两个容器类, 都是 `vector`, 只是一个来自 C++ STL, 一个来自 Qt. 发现两者基本上都提供了相同的接口. 但是不同于 C++ STL 对性能的极致追求, Qt 中的 `QVector` 多了一些安全检查. 这给我一个启示, 或许在开发前期应该使用对开发友好的版本, 若追求性能, 再替换为性能较好的版本.
